<!DOCTYPE html>
<html>
  <head>
    <title>threejs-hologram</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <link rel="stylesheet" href="css/main.css"/>
  </head>
  <body  ontouchmove="event.preventDefault();">
    <div class="container">
      <div class="top"></div>
      <div class="left"></div>
      <div class="right"></div>
      <div class="bottom"></div>
    </div>
    <script src="js/three.min.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/framerate.js"></script>
    <script src="js/inflate.min.js"></script>
    <script src="js/FBXLoader.js"></script>
    <script>
      //获取定影样式类名的元素的宽度
      var getWidth = function(className){
        var element = document.getElementsByClassName(className);
        if(!element||element.length<=0)
          return 0;
        else
          return parseFloat(element[0].offsetWidth);
      };
      //获取定影样式类名的元素的高度
      var getHeight = function(className){
        var element = document.getElementsByClassName(className);
        if(!element||element.length<=0)
          return 0;
        else
          return parseFloat(element[0].offsetHeight);
      };

      //设置top/left/right/bottom的高度与绝对位置。
      var heightValue = getWidth("top")+"px";
      document.getElementsByClassName("top")[0].style.height=heightValue;
      document.getElementsByClassName("left")[0].style.height=heightValue;
      document.getElementsByClassName("right")[0].style.height=heightValue;
      document.getElementsByClassName("bottom")[0].style.height=heightValue;
      document.getElementsByClassName("right")[0].style.top=heightValue;
      document.getElementsByClassName("left")[0].style.top=heightValue;
      document.getElementsByClassName("bottom")[0].style.top=parseFloat(heightValue) * 2 + 'px';
    </script>
    <script>
      //初始化四个场景
      var scene1 = new THREE.Scene();    //前方
      var scene2 = new THREE.Scene();    //右方
      var scene3 = new THREE.Scene();    //后方
      var scene4 = new THREE.Scene();    //左方
      //初始化一台摄像机
      var camera = new THREE.PerspectiveCamera(75,getWidth('bottom')/getHeight('bottom'),0.1,1000);
      //初始化四个渲染器
      var renderer1 = new THREE.WebGLRenderer();     //前方
      var renderer2 = new THREE.WebGLRenderer();     //左方
      var renderer3 = new THREE.WebGLRenderer();     //后方
      var renderer4 = new THREE.WebGLRenderer();     //右方
      //渲染器设置宽高
      renderer1.setSize(window.getWidth('bottom'),window.getHeight('bottom'));
      renderer2.setSize(window.getWidth('left'),window.getHeight('left'));
      renderer3.setSize(window.getWidth('top'),window.getHeight('top'));
      renderer4.setSize(window.getWidth('right'),window.getHeight('right'));
      //将渲染目标与相应div绑定
      document.getElementsByClassName("bottom")[0].appendChild(renderer1.domElement);
      document.getElementsByClassName("left")[0].appendChild(renderer2.domElement);
      document.getElementsByClassName("top")[0].appendChild(renderer3.domElement);
      document.getElementsByClassName("right")[0].appendChild(renderer4.domElement);
      //定义控制器
      var control = new THREE.OrbitControls(camera);
      control.enableZoom = false;
      control.enablePan = false;
      //设置摄像机位置
      var cameraZ=180;
      camera.position.set(0,0,cameraZ);
      //设置摄像机镜头目标坐标
      camera.lookAt(0,0,0);

      //定义光照
      var ambientLight = new THREE.AmbientLight(0xffffff,0.2);
      scene1.add(ambientLight.clone());
      scene2.add(ambientLight.clone());
      scene3.add(ambientLight.clone());
      scene4.add(ambientLight.clone());

      var directionLight1 = new THREE.DirectionalLight(0xffffff,0.8);
      directionLight1.position.set(300,0,400);
      directionLight1.castShadow = true;
      directionLight1.mapSize = new THREE.Vector2(1024,1024);
      var directionLight2 = new THREE.DirectionalLight(0x9999ff,0.2);
      directionLight2.position.set(-300,0,-400);
      directionLight2.castShadow = true;
      directionLight2.mapSize = new THREE.Vector2(1024,1024);
      var light1Clone1 = directionLight1.clone();
      var light1Clone2 = directionLight1.clone();
      var light1Clone3 = directionLight1.clone();
      var light1Clone4 = directionLight1.clone();
      var light2Clone1 = directionLight2.clone();
      var light2Clone2 = directionLight2.clone();
      var light2Clone3 = directionLight2.clone();
      var light2Clone4 = directionLight2.clone();
      scene1.add(light1Clone1);
      scene2.add(light1Clone2);
      scene3.add(light1Clone3);
      scene4.add(light1Clone4);
      scene1.add(light2Clone1);
      scene2.add(light2Clone2);
      scene3.add(light2Clone3);
      scene4.add(light2Clone4);

      //背景盒
      //var backgroundGeometry = new THREE.BoxGeometry(1000,1000,1000);
      //var backgroundMaterial = new THREE.MeshBasicMaterial(
      //  {map:new THREE.TextureLoader().load("asset/textures/background-stars.jpg"),side:THREE.DoubleSide});
      //var background = new THREE.Mesh(backgroundGeometry,backgroundMaterial);
      //background.position.set(0,0,0)
      //scene1.add(background.clone());
      //scene2.add(background.clone());
      //scene3.add(background.clone());
      //scene4.add(background.clone());

      //载入fbx物体
      var mesh1,mesh2,mesh3,mesh4;
      var fgxloader = new THREE.FBXLoader().
      load("asset/source/threejs_mars.fbx",function(object){
        mesh1=object.clone().rotateZ(Math.PI);
        mesh2=object.clone().rotateZ(Math.PI);
        mesh3=object.clone().rotateZ(Math.PI);
        mesh4=object.clone().rotateZ(Math.PI);
        mesh1.receiveShadow = true;
        mesh2.receiveShadow = true;
        mesh3.receiveShadow = true;
        mesh4.receiveShadow = true;
        scene1.add(mesh1);
        scene2.add(mesh2);
        scene3.add(mesh3);
        scene4.add(mesh4);
      },function(xhr){
        console.log("object "+(xhr.loaded/xhr.total*100)+"% loaded");
      },function(error){
        alert(error);
      });

      var cloud1,cloud2,cloud3,cloud4
      fgxloader = new THREE.FBXLoader().
      load("asset/source/threejs_marscloud.fbx",function(object){
        console.log(object.toJSON());
        cloud1=object.clone().rotateZ(Math.PI);
        cloud2=object.clone().rotateZ(Math.PI);
        cloud3=object.clone().rotateZ(Math.PI);
        cloud4=object.clone().rotateZ(Math.PI);
        cloud1.receiveShadow = true;
        cloud2.receiveShadow = true;
        cloud3.receiveShadow = true;
        cloud4.receiveShadow = true;
        scene1.add(cloud1);
        scene2.add(cloud2);
        scene3.add(cloud3);
        scene4.add(cloud4);
      },function(xhr){
        console.log("object "+(xhr.loaded/xhr.total*100)+"% loaded");
      },function(error){
        alert(error);
      });

      //定义修改函数，用于修改场景参数
      var lightSpeed = 0;
      var objectSpeed = 0.004;
      var cloudSpeed = 0.007;
      var update = function(){
        lightSpeed+=0.005;
        light1Clone1.position.x = 500*Math.cos(Math.PI/2+lightSpeed);
        light1Clone1.position.z = 500*Math.sin(Math.PI/2+lightSpeed);
        light1Clone2.position.x = 500*Math.cos(Math.PI/2+lightSpeed);
        light1Clone2.position.z = 500*Math.sin(Math.PI/2+lightSpeed);
        light1Clone3.position.x = 500*Math.cos(Math.PI/2+lightSpeed);
        light1Clone3.position.z = 500*Math.sin(Math.PI/2+lightSpeed);
        light1Clone4.position.x = 500*Math.cos(Math.PI/2+lightSpeed);
        light1Clone4.position.z = 500*Math.sin(Math.PI/2+lightSpeed);
        light2Clone1.position.x = 500*Math.cos(-Math.PI/2+lightSpeed);
        light2Clone1.position.z = 500*Math.sin(-Math.PI/2+lightSpeed);
        light2Clone2.position.x = 500*Math.cos(-Math.PI/2+lightSpeed);
        light2Clone2.position.z = 500*Math.sin(-Math.PI/2+lightSpeed);
        light2Clone3.position.x = 500*Math.cos(-Math.PI/2+lightSpeed);
        light2Clone3.position.z = 500*Math.sin(-Math.PI/2+lightSpeed);
        light2Clone4.position.x = 500*Math.cos(-Math.PI/2+lightSpeed);
        light2Clone4.position.z = 500*Math.sin(-Math.PI/2+lightSpeed);

        if(mesh1===undefined||mesh2===undefined||mesh3===undefined||mesh4===undefined)
          return;
        mesh1.rotateY(objectSpeed);
        mesh2.rotateY(objectSpeed);
        mesh3.rotateY(objectSpeed);
        mesh4.rotateY(objectSpeed);

        if(cloud1===undefined||cloud2===undefined||cloud3===undefined||cloud4===undefined)
          return;
        cloud1.rotateY(cloudSpeed);
        cloud2.rotateY(cloudSpeed);
        cloud3.rotateY(cloudSpeed);
        cloud4.rotateY(cloudSpeed);
      };

      //定义渲染函数，
      var render = function(){
        renderer1.render(scene1,camera.clone());
        renderer2.render(scene2,camera.clone().translateX(-cameraZ).translateZ(-cameraZ).rotateY(-Math.PI/2).rotateZ(Math.PI/2));
        renderer3.render(scene3,camera.clone().translateZ(-cameraZ*2).rotateY(Math.PI).rotateZ(Math.PI));
        renderer4.render(scene4,camera.clone().translateX(cameraZ).translateZ(-cameraZ).rotateY(Math.PI/2).rotateZ(-Math.PI/2));
      };
      //定义循环执行函数
      var GameLoop = function(){
        requestAnimationFrame(GameLoop);
        update();
        render();
      };

      GameLoop();
    </script>
    <script>

    </script>
  </body>
</html>
