<html>
  <head>
    <title>leap v2</title>
    <meta charset="utf-8"/>
    <meta name='viewport' content="width=device-width, initial-scale=1, maximum-scale=1"/>
  </head>
  <body>
    <h1>Hello, LeapJS (V2)</h1>
    <div id="output">
      <script type="text/html" id="template">
        <div>GestureID:{{gestureid}}</div>
        <div>Gesture state:{{gestureState}}</div>
        <div>Gesture startPosition:{{startPositionX}},{{startPositionY}},{{startPositionZ}}</div>
        <div>Gesture position:{{positionX}},{{positionY}},{{positionZ}}</div>
        <div>Gesture endPosition:{{endPositionX}},{{endPositionY}},{{endPositionZ}}</div>
        <div>Gesture direction:{{direction}}</div>
      </script>
    </div>
    <script src="node_modules/leapjs/leap-0.6.4.min.js"></script>
    <script src="node_modules/mustache/mustache.min.js"></script>
    <script>
      var swipeid = 0;                         //当前手势ID
      var output = document.getElementById("output");
      var options = {enableGesures:true};
      var processTime = null;
      var timeout = 0;
      var data={
        gestureid:0,
        gestureState:"",
        startPositionX:0,
        startPositionY:0,
        startPositionZ:0,
        positionX:0,
        positionY:0,
        positionZ:0,
        endPositionX:0,
        endPositionY:0,
        endPositionZ:0,
        direction:""
      };

      var resetData = function(){
        data={
          gestureid:0,
          gestureState:"",
          startPositionX:0,
          startPositionY:0,
          startPositionZ:0,
          positionX:0,
          positionY:0,
          positionZ:0,
          endPositionX:0,
          endPositionY:0,
          endPositionZ:0,
          direction:""
        };
      }
      var template = document.getElementById("template").innerHTML.trim();
      Mustache.parse(template);

      var controller = new Leap.Controller(options);
      controller.connect();

      controller.on('frame',function(frame){
        output.innerHTML = Mustache.render(template,data);
        var current = new Date();
        if(processTime!==null){
          var diff = Math.abs(current-processTime);
          if(diff>5000&&frame.hands.length<=0){
            resetData();
          }
        }
      });

      var gestureString = "";
      controller.on('gesture',function(gesture,frame){
        if(gesture.type === "swipe"){
          if(timeout>0)
            clearTimeout(timeout);
          data.gestureState = gesture.state;
          if(gesture.state === "start"){
            isGestureProcessing = true;
            processTime = new Date();
            if(gesture.handIds.length==1){
              data.gestureid=gesture.id;
              data.startPositionX=gesture.startPosition[0];
              data.startPositionY=gesture.startPosition[1];
              data.startPositionZ=gesture.startPosition[2];
            }
          }
          else if (gesture.state === "update"){
            processTime = new Date();
            if(gesture.handIds.length==1){
              if(gesture.direction[0]>0){
                data.direction = "right";
              }else{
                data.direction = "left";
              }
              data.positionX=gesture.position[0];
              data.positionY=gesture.position[1];
              data.positionZ=gesture.position[2];
            }
          }
          else if(gesture.state ==="stop"){
            isGestureProcessing = false;
            if(gesture.handIds.length==1){
              data.endPositionX=gesture.position[0];
              data.endPositionY=gesture.position[1];
              data.endPositionZ=gesture.position[2];
            }
          }
        }
      });
    </script>
  </body>
</html>
